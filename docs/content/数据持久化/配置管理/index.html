<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-content/数据持久化/配置管理" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">配置管理 | CDDA中文攻略手册</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://surflurer.github.io/CDDA-CN-Guide/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://surflurer.github.io/CDDA-CN-Guide/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://surflurer.github.io/CDDA-CN-Guide/docs/content/数据持久化/配置管理"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="配置管理 | CDDA中文攻略手册"><meta data-rh="true" name="description" content="本文引用的文件"><meta data-rh="true" property="og:description" content="本文引用的文件"><link data-rh="true" rel="icon" href="/CDDA-CN-Guide/img/cataicon.ico"><link data-rh="true" rel="canonical" href="https://surflurer.github.io/CDDA-CN-Guide/docs/content/数据持久化/配置管理"><link data-rh="true" rel="alternate" href="https://surflurer.github.io/CDDA-CN-Guide/docs/content/数据持久化/配置管理" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://surflurer.github.io/CDDA-CN-Guide/docs/content/数据持久化/配置管理" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"数据持久化","item":"https://surflurer.github.io/CDDA-CN-Guide/docs/content/数据持久化/"},{"@type":"ListItem","position":2,"name":"配置管理","item":"https://surflurer.github.io/CDDA-CN-Guide/docs/content/数据持久化/配置管理"}]}</script><link rel="stylesheet" href="/CDDA-CN-Guide/assets/css/styles.c3de5195.css">
<script src="/CDDA-CN-Guide/assets/js/runtime~main.0ee1e93b.js" defer="defer"></script>
<script src="/CDDA-CN-Guide/assets/js/main.4d48cbd5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/CDDA-CN-Guide/img/cataicon.ico"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/CDDA-CN-Guide/"><div class="navbar__logo"><img src="/CDDA-CN-Guide/img/cataicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/CDDA-CN-Guide/img/cataicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">CDDA中文攻略手册</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/CDDA-CN-Guide/docs/总目录">目录</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/SurFlurer/CDDA-CN-Guide" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/CDDA-CN-Guide/docs/总目录"><span title="CataclysmDDA综合攻略手册" class="linkLabel_WmDU">CataclysmDDA综合攻略手册</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/CDDA-CN-Guide/docs/基础教程"><span title="玩家手册" class="categoryLinkLabel_W154">玩家手册</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/CDDA-CN-Guide/docs/content/世界生成系统/"><span title="开发者手册" class="categoryLinkLabel_W154">开发者手册</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/世界生成系统/"><span title="世界生成系统" class="categoryLinkLabel_W154">世界生成系统</span></a><button aria-label="展开侧边栏分类 &#x27;世界生成系统&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/国际化系统/"><span title="国际化系统" class="categoryLinkLabel_W154">国际化系统</span></a><button aria-label="展开侧边栏分类 &#x27;国际化系统&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/平台适配/"><span title="平台适配" class="categoryLinkLabel_W154">平台适配</span></a><button aria-label="展开侧边栏分类 &#x27;平台适配&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/开发工具与测试/"><span title="开发工具与测试" class="categoryLinkLabel_W154">开发工具与测试</span></a><button aria-label="展开侧边栏分类 &#x27;开发工具与测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/CDDA-CN-Guide/docs/content/快速开始"><span title="快速开始" class="linkLabel_WmDU">快速开始</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/战斗与AI系统/"><span title="战斗与AI系统" class="categoryLinkLabel_W154">战斗与AI系统</span></a><button aria-label="展开侧边栏分类 &#x27;战斗与AI系统&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/CDDA-CN-Guide/docs/content/数据持久化/"><span title="数据持久化" class="categoryLinkLabel_W154">数据持久化</span></a><button aria-label="折叠侧边栏分类 &#x27;数据持久化&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/CDDA-CN-Guide/docs/content/数据持久化/保存系统"><span title="保存系统" class="linkLabel_WmDU">保存系统</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/CDDA-CN-Guide/docs/content/数据持久化/配置管理"><span title="配置管理" class="linkLabel_WmDU">配置管理</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/核心架构设计/"><span title="核心架构设计" class="categoryLinkLabel_W154">核心架构设计</span></a><button aria-label="展开侧边栏分类 &#x27;核心架构设计&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/模组系统/"><span title="模组系统" class="categoryLinkLabel_W154">模组系统</span></a><button aria-label="展开侧边栏分类 &#x27;模组系统&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/游戏核心系统/"><span title="游戏核心系统" class="categoryLinkLabel_W154">游戏核心系统</span></a><button aria-label="展开侧边栏分类 &#x27;游戏核心系统&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/用户界面与渲染/"><span title="用户界面与渲染" class="categoryLinkLabel_W154">用户界面与渲染</span></a><button aria-label="展开侧边栏分类 &#x27;用户界面与渲染&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/CDDA-CN-Guide/docs/content/部署与发布/"><span title="部署与发布" class="categoryLinkLabel_W154">部署与发布</span></a><button aria-label="展开侧边栏分类 &#x27;部署与发布&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/CDDA-CN-Guide/docs/content/项目概述"><span title="项目概述" class="linkLabel_WmDU">项目概述</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/CDDA-CN-Guide/docs/往期更新记录"><span title="往期更新记录" class="linkLabel_WmDU">往期更新记录</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/CDDA-CN-Guide/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">开发者手册</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/CDDA-CN-Guide/docs/content/数据持久化/"><span>数据持久化</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">配置管理</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>配置管理</h1></header><cite>
**本文引用的文件**
- src/options.h
- src/options.cpp
- src/cached_options.h
- src/cached_options.cpp
- src/regional_settings.h
- src/regional_settings.cpp
- src/system_locale.cpp
- src/json_loader.cpp
- src/flexbuffer_cache.cpp
- src/worldfactory.cpp
</cite>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="目录">目录<a href="#目录" class="hash-link" aria-label="目录的直接链接" title="目录的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><a href="#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86" class="">配置管理</a>
<ul>
<li class=""><a href="#%E7%9B%AE%E5%BD%95" class="">目录</a></li>
<li class=""><a href="#%E7%AE%80%E4%BB%8B" class="">简介</a></li>
<li class=""><a href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84" class="">项目结构</a></li>
<li class=""><a href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6" class="">核心组件</a></li>
<li class=""><a href="#%E6%9E%B6%E6%9E%84%E6%80%BB%E8%A7%88" class="">架构总览</a></li>
<li class=""><a href="#%E8%AF%A6%E7%BB%86%E7%BB%84%E4%BB%B6%E5%88%86%E6%9E%90" class="">详细组件分析</a>
<ul>
<li class=""><a href="#%E9%80%89%E9%A1%B9%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" class="">选项系统架构与生命周期</a></li>
<li class=""><a href="#%E7%BC%93%E5%AD%98%E9%80%89%E9%A1%B9%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B8%8E%E4%BC%A0%E6%92%AD" class="">缓存选项系统（性能优化与传播）</a></li>
<li class=""><a href="#%E5%8C%BA%E5%9F%9F%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E6%9C%AC%E5%9C%B0%E5%8C%96%E6%97%B6%E5%8C%BA%E4%B8%8E%E8%B4%A7%E5%B8%81%E6%A0%BC%E5%BC%8F%E5%8C%96" class="">区域设置管理（本地化、时区与货币格式化）</a></li>
<li class=""><a href="#%E7%B3%BB%E7%BB%9F%E5%8C%BA%E5%9F%9F%E4%B8%8E%E6%9C%AC%E5%9C%B0%E5%8C%96" class="">系统区域与本地化</a></li>
<li class=""><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E4%B8%8E%E9%AA%8C%E8%AF%81" class="">配置文件读写与验证</a></li>
<li class=""><a href="#%E4%B8%96%E7%95%8C%E9%80%89%E9%A1%B9%E5%8A%A0%E8%BD%BD%E4%B8%8E%E8%BF%81%E7%A7%BB" class="">世界选项加载与迁移</a></li>
</ul>
</li>
<li class=""><a href="#%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E5%88%86%E6%9E%90" class="">依赖关系分析</a></li>
<li class=""><a href="#%E6%80%A7%E8%83%BD%E8%80%83%E9%87%8F" class="">性能考量</a></li>
<li class=""><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E6%8C%87%E5%8D%97" class="">故障排查指南</a></li>
<li class=""><a href="#%E7%BB%93%E8%AE%BA" class="">结论</a></li>
<li class=""><a href="#%E9%99%84%E5%BD%95%E9%85%8D%E7%BD%AE%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97" class="">附录：配置扩展开发指南</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="简介">简介<a href="#简介" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接" translate="no">​</a></h2>
<p>本文件系统性梳理 Cataclysm-DDA 的配置管理系统，覆盖选项系统架构（配置项定义、默认值处理、运行时修改）、缓存选项系统（性能优化与传播机制）、区域设置管理（本地化、时区与货币格式化）、配置文件读写与验证、错误处理策略，以及面向扩展开发者的配置新增与迁移方案。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="项目结构">项目结构<a href="#项目结构" class="hash-link" aria-label="项目结构的直接链接" title="项目结构的直接链接" translate="no">​</a></h2>
<p>配置管理相关代码主要分布在以下模块：</p>
<ul>
<li class="">选项系统与UI：options.h/.cpp</li>
<li class="">运行时缓存选项：cached_options.h/.cpp</li>
<li class="">区域设置与地图生成参数：regional_settings.h/.cpp</li>
<li class="">语言与系统区域：system_locale.cpp</li>
<li class="">JSON加载与缓存：json_loader.cpp、flexbuffer_cache.cpp</li>
<li class="">世界选项加载：worldfactory.cpp</li>
</ul>
<!-- -->
<p>图表来源</p>
<ul>
<li class="">src/options.cpp</li>
<li class="">src/cached_options.h</li>
<li class="">src/regional_settings.cpp</li>
<li class="">src/system_locale.cpp</li>
<li class="">src/json_loader.cpp</li>
<li class="">src/flexbuffer_cache.cpp</li>
<li class="">src/worldfactory.cpp</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/options.h</li>
<li class="">src/options.cpp</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="核心组件">核心组件<a href="#核心组件" class="hash-link" aria-label="核心组件的直接链接" title="核心组件的直接链接" translate="no">​</a></h2>
<ul>
<li class="">选项管理器 options_manager：集中注册、组织、序列化/反序列化选项；维护页面与分组；提供运行时修改接口；支持前置条件与隐藏规则。</li>
<li class="">选项类型 cOpt：封装单个配置项的类型、取值、默认值、UI显示文本、可选值列表、范围与步进等。</li>
<li class="">缓存选项 cached_options：将高频访问的布尔/整数/浮点选项复制到全局变量，避免每次查找字符串键的开销。</li>
<li class="">区域设置 regional_settings：按区域聚合地图生成、天气、地貌、道路、河流、湖泊、海洋等参数，支持覆盖与校验。</li>
<li class="">系统区域 SystemLocale：提供语言、度量单位、时间格式等系统级偏好查询。</li>
<li class="">JSON加载与缓存：统一从路径解析JSON，使用flexbuffer缓存提升加载性能。</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/options.h</li>
<li class="">src/options.cpp</li>
<li class="">src/cached_options.h</li>
<li class="">src/cached_options.cpp</li>
<li class="">src/regional_settings.h</li>
<li class="">src/system_locale.cpp</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="架构总览">架构总览<a href="#架构总览" class="hash-link" aria-label="架构总览的直接链接" title="架构总览的直接链接" translate="no">​</a></h2>
<p>选项系统采用“声明式注册 + 页面/分组组织 + 运行时修改 + 缓存访问”的分层设计。初始化阶段通过 add_options_* 系列函数注册所有选项，随后在UI中按页展示；运行时通过 cOpt 的 setValue 等方法修改当前值；高频读取通过 cached_options 直接访问，减少哈希查找成本；区域设置与系统区域为配置提供上下文环境。</p>
<!-- -->
<p>图表来源</p>
<ul>
<li class="">src/options.h</li>
<li class="">src/options.cpp</li>
<li class="">src/cached_options.h</li>
<li class="">src/regional_settings.h</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="详细组件分析">详细组件分析<a href="#详细组件分析" class="hash-link" aria-label="详细组件分析的直接链接" title="详细组件分析的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="选项系统架构与生命周期">选项系统架构与生命周期<a href="#选项系统架构与生命周期" class="hash-link" aria-label="选项系统架构与生命周期的直接链接" title="选项系统架构与生命周期的直接链接" translate="no">​</a></h3>
<ul>
<li class="">初始化：options_manager::init 清空旧状态，调用 add_options_* 注册通用、界面、图形、世界默认、调试、Android 等页面。</li>
<li class="">页面与分组：Page/Group 结构用于在UI中组织选项；支持空行与分组头；支持移除重复空行以优化显示。</li>
<li class="">选项注册：提供多种 add 重载，分别对应 bool/string_select/string_input/int/int_map/float 等类型；自动设置默认值与范围；支持隐藏规则（如平台/构建特性）。</li>
<li class="">值修改：cOpt::setValue/setNext/setPrev 支持运行时修改；对字符串输入会截断至最大长度；对数值类型进行边界检查并回退到默认值。</li>
<li class="">序列化：options_manager::serialize/deserialize 将选项容器写入/读取 JSON；支持外部选项（add_external）与世界选项（worldfactory 加载）。</li>
</ul>
<!-- -->
<p>图表来源</p>
<ul>
<li class="">src/options.cpp</li>
<li class="">src/options.cpp</li>
<li class="">src/options.cpp</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/options.cpp</li>
<li class="">src/options.cpp</li>
<li class="">src/options.cpp</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="缓存选项系统性能优化与传播">缓存选项系统（性能优化与传播）<a href="#缓存选项系统性能优化与传播" class="hash-link" aria-label="缓存选项系统（性能优化与传播）的直接链接" title="缓存选项系统（性能优化与传播）的直接链接" translate="no">​</a></h3>
<ul>
<li class="">设计目标：将频繁读取的选项复制到全局变量，避免每次通过字符串键查找。</li>
<li class="">更新机制：options_manager 提供 update_options_cache 静态方法，遍历已注册选项，将当前值同步到 cached_options 中的全局变量。</li>
<li class="">影响范围：游戏主循环或渲染前调用该方法，确保缓存与当前选项一致；典型场景包括渲染、日志、鼠标行为等高频分支判断。</li>
</ul>
<!-- -->
<p>图表来源</p>
<ul>
<li class="">src/options.cpp</li>
<li class="">src/cached_options.h</li>
<li class="">src/cached_options.cpp</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/options.cpp</li>
<li class="">src/cached_options.h</li>
<li class="">src/cached_options.cpp</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="区域设置管理本地化时区与货币格式化">区域设置管理（本地化、时区与货币格式化）<a href="#区域设置管理本地化时区与货币格式化" class="hash-link" aria-label="区域设置管理（本地化、时区与货币格式化）的直接链接" title="区域设置管理（本地化、时区与货币格式化）的直接链接" translate="no">​</a></h3>
<ul>
<li class="">数据模型：regional_settings 聚合城市布局、森林地形、河流/湖泊/海洋/峡谷、高速公路、连接关系、地面覆盖等；支持按区域覆盖（overlay）。</li>
<li class="">加载流程：load_region_settings 解析 JSON，填充 regional_settings；load_region_overlay 对指定区域应用覆盖；check_region_settings 校验权重有效性。</li>
<li class="">使用场景：地图生成、天气模拟、地貌分布等；通过 get_option 访问相关布尔/数值选项控制具体行为。</li>
</ul>
<!-- -->
<p>图表来源</p>
<ul>
<li class="">src/regional_settings.cpp</li>
<li class="">src/regional_settings.cpp</li>
<li class="">src/regional_settings.cpp</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/regional_settings.h</li>
<li class="">src/regional_settings.cpp</li>
<li class="">src/regional_settings.cpp</li>
<li class="">src/regional_settings.cpp</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="系统区域与本地化">系统区域与本地化<a href="#系统区域与本地化" class="hash-link" aria-label="系统区域与本地化的直接链接" title="系统区域与本地化的直接链接" translate="no">​</a></h3>
<ul>
<li class="">语言选择：options_manager::get_lang_options 提供可用语言列表，结合系统区域偏好（SystemLocale::UseMetricSystem）设置默认单位。</li>
<li class="">语言切换：setlocale 全局设置 C/C++ 本地化，确保数字/货币/日期等格式符合目标语言环境。</li>
<li class="">度量单位：根据系统区域返回值动态设置温度、速度、质量、体积、距离等单位的默认值。</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/options.cpp</li>
<li class="">src/system_locale.cpp</li>
<li class="">src/options.cpp</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="配置文件读写与验证">配置文件读写与验证<a href="#配置文件读写与验证" class="hash-link" aria-label="配置文件读写与验证的直接链接" title="配置文件读写与验证的直接链接" translate="no">​</a></h3>
<ul>
<li class="">JSON加载：json_loader.cpp 统一从路径解析 JSON，使用 flexbuffer_cache.cpp 缓存解析结果，避免重复解析。</li>
<li class="">配置写入：options_manager::serialize/deserialize 将选项容器序列化为 JSON；save() 调用序列化后写盘。</li>
<li class="">错误处理：解析失败抛出异常；校验不合法权重/覆盖区域时报错；调试信息输出帮助定位问题。</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/json_loader.cpp</li>
<li class="">src/flexbuffer_cache.cpp</li>
<li class="">src/options.cpp</li>
<li class="">src/options.cpp</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="世界选项加载与迁移">世界选项加载与迁移<a href="#世界选项加载与迁移" class="hash-link" aria-label="世界选项加载与迁移的直接链接" title="世界选项加载与迁移的直接链接" translate="no">​</a></h3>
<ul>
<li class="">世界选项：worldfactory.cpp 提供 load_world_option，批量启用某些选项作为世界默认。</li>
<li class="">外部选项：load_external_option 支持从 JSON 动态添加外部选项并赋值，兼容迁移场景。</li>
<li class="">选项迁移：options_manager 提供 migrateOptionName/migrateOptionValue 机制，映射旧名称与旧值到新名称/值。</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/worldfactory.cpp</li>
<li class="">src/options.cpp</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="依赖关系分析">依赖关系分析<a href="#依赖关系分析" class="hash-link" aria-label="依赖关系分析的直接链接" title="依赖关系分析的直接链接" translate="no">​</a></h2>
<ul>
<li class="">options_manager 依赖 cached_options（更新缓存）、regional_settings（读取区域参数）、system_locale（语言/单位偏好）。</li>
<li class="">JSON加载链路：json_loader.cpp -&gt; flexbuffer_cache.cpp -&gt; 业务模块（选项/区域设置）。</li>
<li class="">世界工厂依赖 options_manager 获取/设置选项。</li>
</ul>
<!-- -->
<p>图表来源</p>
<ul>
<li class="">src/options.cpp</li>
<li class="">src/json_loader.cpp</li>
<li class="">src/flexbuffer_cache.cpp</li>
<li class="">src/worldfactory.cpp</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/options.cpp</li>
<li class="">src/json_loader.cpp</li>
<li class="">src/flexbuffer_cache.cpp</li>
<li class="">src/worldfactory.cpp</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="性能考量">性能考量<a href="#性能考量" class="hash-link" aria-label="性能考量的直接链接" title="性能考量的直接链接" translate="no">​</a></h2>
<ul>
<li class="">缓存访问：高频读取通过 cached_options 直接访问全局变量，避免哈希查找与字符串比较。</li>
<li class="">JSON缓存：flexbuffer_cache 将解析后的 JSON 结果缓存到磁盘，按修改时间与偏移快速命中，显著降低启动与切换配置的延迟。</li>
<li class="">选项更新批处理：集中调用 update_options_cache，在关键帧或切换场景一次性同步，避免分散更新带来的重复计算。</li>
<li class="">UI渲染优化：页面/分组结构在初始化时整理，移除重复空行，减少渲染负担。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="故障排查指南">故障排查指南<a href="#故障排查指南" class="hash-link" aria-label="故障排查指南的直接链接" title="故障排查指南的直接链接" translate="no">​</a></h2>
<ul>
<li class="">选项未生效：确认是否调用了 update_options_cache；检查前置条件 checkPrerequisite 是否满足；核对隐藏规则（平台/构建特性）。</li>
<li class="">语言/单位异常：检查 SystemLocale 返回值与 USE_LANG 选项；确认 setlocale 设置成功。</li>
<li class="">区域设置无效：检查 load_region_settings/apply_region_overlay 是否正确执行；使用 check_region_settings 定位权重问题。</li>
<li class="">JSON加载失败：查看 json_loader/flexbuffer_cache 抛出的错误；确认文件存在且格式正确；检查缓存目录权限。</li>
<li class="">世界选项未加载：确认 worldfactory 的 load_world_option 调用路径；检查 JSON 中 options 数组是否为空。</li>
</ul>
<p>章节来源</p>
<ul>
<li class="">src/options.cpp</li>
<li class="">src/options.cpp</li>
<li class="">src/regional_settings.cpp</li>
<li class="">src/json_loader.cpp</li>
<li class="">src/flexbuffer_cache.cpp</li>
<li class="">src/worldfactory.cpp</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="结论">结论<a href="#结论" class="hash-link" aria-label="结论的直接链接" title="结论的直接链接" translate="no">​</a></h2>
<p>CDDA 的配置系统以 options_manager 为核心，结合页面/分组组织、类型安全的 cOpt、运行时修改与缓存访问，形成高可维护、高性能的配置生态。区域设置与系统区域为复杂玩法提供上下文支持。通过 JSON 缓存与集中更新策略，系统在功能丰富的同时保持良好的性能表现。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="附录配置扩展开发指南">附录：配置扩展开发指南<a href="#附录配置扩展开发指南" class="hash-link" aria-label="附录：配置扩展开发指南的直接链接" title="附录：配置扩展开发指南的直接链接" translate="no">​</a></h2>
<ul>
<li class="">新增选项
<ul>
<li class="">在 add_options_* 中注册：根据类型选择对应的 add 重载；设置默认值、范围/步进、UI 文本与提示。</li>
<li class="">可选：设置隐藏规则（如平台/构建特性）；设置前置条件（依赖其他选项的值）。</li>
<li class="">参考路径：src/options.cpp</li>
</ul>
</li>
<li class="">运行时修改
<ul>
<li class="">通过 get_options().get_option(name).setValue(...) 修改；必要时调用 update_options_cache 同步缓存。</li>
<li class="">参考路径：src/options.cpp, src/options.cpp</li>
</ul>
</li>
<li class="">世界默认选项
<ul>
<li class="">在 worldfactory 中使用 load_world_option 批量启用；或通过外部选项机制 add_external + load_external_option 注入。</li>
<li class="">参考路径：src/worldfactory.cpp</li>
</ul>
</li>
<li class="">配置文件格式
<ul>
<li class="">选项序列化为 JSON；区域设置/覆盖为独立对象；外部选项支持 float/int/bool 类型。</li>
<li class="">参考路径：src/options.cpp, src/regional_settings.cpp</li>
</ul>
</li>
<li class="">配置迁移
<ul>
<li class="">使用 migrateOptionName/migrateOptionValue 映射旧名/旧值；外部选项支持 stub 模式避免覆盖已有设置。</li>
<li class="">参考路径：src/options.cpp, src/worldfactory.cpp</li>
</ul>
</li>
<li class="">性能与验证
<ul>
<li class="">使用 cached_options 减少热点读取；利用 flexbuffer_cache 与 JSON 缓存；在加载后调用 check_* 校验数据有效性。</li>
<li class="">参考路径：src/cached_options.h, src/json_loader.cpp, src/regional_settings.cpp</li>
</ul>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/SurFlurer/CDDA-CN-Guide/edit/master/CataclysmDDA综合攻略手册/docs/content/数据持久化/配置管理.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/CDDA-CN-Guide/docs/content/数据持久化/保存系统"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">保存系统</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/CDDA-CN-Guide/docs/content/核心架构设计/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">核心架构设计</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#目录" class="table-of-contents__link toc-highlight">目录</a></li><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#项目结构" class="table-of-contents__link toc-highlight">项目结构</a></li><li><a href="#核心组件" class="table-of-contents__link toc-highlight">核心组件</a></li><li><a href="#架构总览" class="table-of-contents__link toc-highlight">架构总览</a></li><li><a href="#详细组件分析" class="table-of-contents__link toc-highlight">详细组件分析</a><ul><li><a href="#选项系统架构与生命周期" class="table-of-contents__link toc-highlight">选项系统架构与生命周期</a></li><li><a href="#缓存选项系统性能优化与传播" class="table-of-contents__link toc-highlight">缓存选项系统（性能优化与传播）</a></li><li><a href="#区域设置管理本地化时区与货币格式化" class="table-of-contents__link toc-highlight">区域设置管理（本地化、时区与货币格式化）</a></li><li><a href="#系统区域与本地化" class="table-of-contents__link toc-highlight">系统区域与本地化</a></li><li><a href="#配置文件读写与验证" class="table-of-contents__link toc-highlight">配置文件读写与验证</a></li><li><a href="#世界选项加载与迁移" class="table-of-contents__link toc-highlight">世界选项加载与迁移</a></li></ul></li><li><a href="#依赖关系分析" class="table-of-contents__link toc-highlight">依赖关系分析</a></li><li><a href="#性能考量" class="table-of-contents__link toc-highlight">性能考量</a></li><li><a href="#故障排查指南" class="table-of-contents__link toc-highlight">故障排查指南</a></li><li><a href="#结论" class="table-of-contents__link toc-highlight">结论</a></li><li><a href="#附录配置扩展开发指南" class="table-of-contents__link toc-highlight">附录：配置扩展开发指南</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/CDDA-CN-Guide/docs/总目录">目录</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">社群</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tieba.baidu.com/f?kw=cataclysmdda" target="_blank" rel="noopener noreferrer" class="footer__link-item">百度贴吧<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://pd.qq.com/s/4q2t1dqub" target="_blank" rel="noopener noreferrer" class="footer__link-item">QQ频道<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="http://cdda.fun" target="_blank" rel="noopener noreferrer" class="footer__link-item">幸存者基地<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/CleverRaven/Cataclysm-DDA" target="_blank" rel="noopener noreferrer" class="footer__link-item">游戏GitHub项目地址<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Surflurer, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>